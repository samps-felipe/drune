pipeline_name: customer_pipeline
description: Custom description for the pipeline

defaults:
  # patterns:
  #   rename: snake_case
  #   email: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"

  types:
    # str:
    #   transform: trim|upper
    int:
      try_cast: true
    float:
      format: "{:.2f}"
      try_cast: true
    date:
      format: "yyyy-MM-dd"

sources:
  - name: customer_file
    type: file
    format: csv
    # path: ""
    options:
      header: 0
      delimiter: ","
      encoding: "utf-8"
    
    schema:
      columns:
        - name: cd_customer
          from: customer_id
          description: Identifies the customer
          type: int
          constraints: 
            - rule: "not_null"
              on_fail: "warn"
            - rule: "unique"
              on_fail: "drop"
        - name: nm_first_name
          from: first_name
          type: str
        - name: nm_last_name
          from: last_name
          type: str
        - name: ds_email
          from: email
          type: str
          transform: trim|lower
          optional: true
          constraints:
            - rule: pattern:^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$
              on_fail: warn
        - name: nu_document
          from: document
          type: str
        # - name: ds_login
        #   type: str
        #   transform: regex:email,^[^@]+

target:
  name: dm_customer
  description: Processed customer data for analytics
  type: file
  format: csv
  path: "output/"
  mode: overwrite

  schema:
    primary_key: [customer_id]
    partition_by: []

    inherits:
      - from: customer_file
        exclude: [document]
    
    columns:
      - name: new_column
        type: str
        description: "Newly added column for additional information"  